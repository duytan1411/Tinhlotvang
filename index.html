<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tính lot XAUUSD (Cent) — Tinhlotvang</title>
  <style>
    :root{
      --bg:#0b0f14;
      --card:#121820;
      --muted:#90caf9;
      --accent:#4fc3f7;
      --success:#00e676;
      --danger:#ff5252;
      --surface:#0d1117;
      font-size:16px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100vh;
      background:linear-gradient(180deg,#051018 0%,var(--bg) 100%);
      color:#e6eef6;
      font-family:Inter, system-ui, "Segoe UI", Roboto, Arial, sans-serif;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
    }
    .container{
      width:100%;
      max-width:720px;
      background:var(--card);
      border-radius:12px;
      padding:20px;
      box-shadow:0 8px 30px rgba(2,6,23,0.6);
      border:1px solid rgba(255,255,255,0.02);
    }
    header{display:flex;align-items:center;gap:12px;margin-bottom:8px}
    h1{font-size:18px;margin:0;color:var(--accent)}
    p.lead{margin:0;font-size:13px;color:#a6cde0}
    .grid{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:12px;
      margin-top:14px;
    }
    label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
    input[type="number"], select{
      width:100%;
      padding:10px 12px;
      border-radius:8px;
      border:1px solid rgba(255,255,255,0.04);
      background:#0f1720;color:#eaf6ff;
      font-size:14px;
    }
    .full{grid-column:1/-1}
    .controls{display:flex;gap:8px;align-items:center;margin-top:10px}
    .risk-buttons{display:flex;gap:8px;margin-left:auto}
    button, .btn{
      appearance:none;
      border:0;
      padding:8px 10px;border-radius:8px;
      background:linear-gradient(180deg,#1e88e5,#1976d2);
      color:white;font-weight:600;
      cursor:pointer;
      font-size:13px;
    }
    .small{padding:6px 8px;font-size:13px}
    .result{
      margin-top:14px;
      background:var(--surface);
      padding:12px;border-radius:10px;
      border-left:4px solid var(--success);
      white-space:pre-wrap;
      font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, "Roboto Mono", monospace;
      color:#dff9e6;
      min-height:88px;
    }
    .row{display:flex;gap:8px;align-items:center}
    .meta{font-size:13px;color:#bcdff4}
    .error{color:var(--danger);font-weight:600}
    .footer{margin-top:14px;display:flex;justify-content:space-between;gap:8px;flex-wrap:wrap}
    @media (max-width:600px){
      .grid{grid-template-columns:1fr}
      header{flex-direction:column;align-items:flex-start;gap:6px}
      .risk-buttons{margin-left:0}
    }
  </style>
</head>
<body>
  <div class="container" role="main">
    <header>
      <div>
        <h1>Tính lot XAUUSD (Cent)</h1>
        <p class="lead">Dành cho tài khoản cent — nhập balance (cent). 0.01 lot = 1 giá = 100 cent.</p>
      </div>
    </header>

    <div class="grid" aria-live="polite">
      <div>
        <label for="balance">Balance (cent)</label>
        <input id="balance" type="number" inputmode="numeric" placeholder="VD: 5000" min="0" />
      </div>

      <div>
        <label for="risk">Rủi ro (%)</label>
        <input id="risk" type="range" min="0.5" max="10" step="0.5" value="1" aria-label="Rủi ro phần trăm" />
        <div class="row"><span class="meta">Chọn rủi ro: <strong id="riskVal">1%</strong></span></div>
      </div>

      <div>
        <label for="entry">Entry (giá)</label>
        <input id="entry" type="number" step="0.01" inputmode="decimal" placeholder="VD: 2100.25" />
      </div>

      <div>
        <label for="sl">Stop Loss (giá)</label>
        <input id="sl" type="number" step="0.01" inputmode="decimal" placeholder="VD: 2095.00" />
      </div>

      <div class="full">
        <label for="tp">Take Profit (giá)</label>
        <input id="tp" type="number" step="0.01" inputmode="decimal" placeholder="VD: 2110.00" />
      </div>
    </div>

    <div class="controls">
      <button id="calcBtn" class="btn">Tính ngay</button>

      <div class="risk-buttons" role="group" aria-label="Mức rủi ro nhanh">
        <button class="small" data-risk="1">1%</button>
        <button class="small" data-risk="2">2%</button>
        <button class="small" data-risk="3">3%</button>
        <button class="small" data-risk="4">4%</button>
        <button class="small" data-risk="5">5%</button>
      </div>

      <div style="margin-left:auto;display:flex;gap:8px">
        <button id="copyBtn" class="small">Copy kết quả</button>
        <button id="resetBtn" class="small">Reset</button>
      </div>
    </div>

    <div id="result" class="result" aria-live="polite">Kết quả sẽ hiển thị ở đây.</div>

    <div class="footer">
      <div class="meta">Giải thích nhanh: Lot Cent = (riskCent) / (SL difference * 100). Lot Standard = Lot Cent / 100.</div>
      <div class="meta">Tài khoản: cent — hiển thị tiền ~USD từ cent.</div>
    </div>
  </div>

  <script>
    // Core logic
    const q = (s) => document.querySelector(s);
    const balanceEl = q('#balance');
    const entryEl = q('#entry');
    const slEl = q('#sl');
    const tpEl = q('#tp');
    const riskRange = q('#risk');
    const riskVal = q('#riskVal');
    const resultEl = q('#result');
    const calcBtn = q('#calcBtn');
    const copyBtn = q('#copyBtn');
    const resetBtn = q('#resetBtn');
    const riskQuick = document.querySelectorAll('[data-risk]');

    function formatMoneyFromCent(cents){
      return '$' + (cents/100).toFixed(2);
    }

    function compute(riskPercentOverride){
      const b = parseFloat(balanceEl.value);
      const entry = parseFloat(entryEl.value);
      const sl = parseFloat(slEl.value);
      const tp = parseFloat(tpEl.value);

      // validation
      if (!isFinite(b) || b <= 0) {
        resultEl.innerHTML = '<span class="error">Nhập Balance (cent) hợp lệ (>0).</span>';
        return null;
      }
      if (!isFinite(entry) || !isFinite(sl)) {
        resultEl.innerHTML = '<span class="error">Nhập Entry và Stop Loss hợp lệ.</span>';
        return null;
      }
      if (entry === sl) {
        resultEl.innerHTML = '<span class="error">Entry và SL bằng nhau — không thể tính (dSL = 0).</span>';
        return null;
      }
      const riskPercent = (typeof riskPercentOverride === 'number') ? riskPercentOverride : parseFloat(riskRange.value);
      const riskCent = b * riskPercent / 100;

      const dSL = Math.abs(entry - sl);
      const dTP = (isFinite(tp)) ? Math.abs(tp - entry) : 0;

      // theo quy 0.01 lot = 1 giá = 100 cent
      // LotCent = riskCent / (dSL * 100)
      const lotCentRaw = riskCent / (dSL * 100);
      const lotCent = Math.max(0, Math.round(lotCentRaw * 100) / 100); // 2 decimals
      const lotStd = Math.round((lotCent / 100) * 10000) / 10000; // 4 decimals

      const lossCent = lotCent * dSL * 100;
      const profitCent = dTP ? (lotCent * dTP * 100) : 0;
      const rr = (lossCent > 0) ? (profitCent / lossCent) : 0;

      const lines = [
        `Balance: ${b.toFixed(0)} cent (~${formatMoneyFromCent(b)})`,
        `Rủi ro: ${riskPercent}%  → ${riskCent.toFixed(0)} cent (~${formatMoneyFromCent(riskCent)})`,
        '',
        `Entry: ${entry.toFixed(2)}  |  SL: ${sl.toFixed(2)}  |  TP: ${isFinite(tp) ? tp.toFixed(2) : '—'}`,
        `SL (diff): ${dSL.toFixed(2)} giá  | TP (diff): ${dTP ? dTP.toFixed(2) + ' giá' : '—'}`,
        '',
        `Lot (cent): ${lotCent.toFixed(2)}`,
        `Lot (standard): ${lotStd.toFixed(4)}`,
        '',
        `Lỗ khi SL: ${lossCent.toFixed(0)} cent (~${formatMoneyFromCent(lossCent)})`,
        `Lời khi TP: ${profitCent.toFixed(0)} cent (~${formatMoneyFromCent(profitCent)})`,
        '',
        `Tỷ lệ Rủi ro/Lợi nhuận thực: 1 : ${(rr).toFixed(2)}`
      ];

      resultEl.textContent = lines.join('\n');
      return {
        lotCent, lotStd, lossCent, profitCent, rr, riskCent
      };
    }

    // events
    riskRange.addEventListener('input', e => {
      riskVal.textContent = riskRange.value + '%';
    });

    calcBtn.addEventListener('click', () => compute());

    // quick risk buttons
    riskQuick.forEach(btn => {
      btn.addEventListener('click', (e) => {
        const r = parseFloat(btn.dataset.risk);
        riskRange.value = r;
        riskVal.textContent = r + '%';
        compute(r);
      });
    });

    // update on Enter in any input
    [balanceEl, entryEl, slEl, tpEl].forEach(inp => {
      inp.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') compute();
      });
      inp.addEventListener('input', () => {
        // optional: live compute
        // compute();
      });
    });

    copyBtn.addEventListener('click', async () => {
      try {
        await navigator.clipboard.writeText(resultEl.textContent);
        copyBtn.textContent = 'Đã copy';
        setTimeout(()=> copyBtn.textContent = 'Copy kết quả', 1400);
      } catch (err) {
        copyBtn.textContent = 'Copy lỗi';
        setTimeout(()=> copyBtn.textContent = 'Copy kết quả', 1400);
      }
    });

    resetBtn.addEventListener('click', () => {
      balanceEl.value = '';
      entryEl.value = '';
      slEl.value = '';
      tpEl.value = '';
      riskRange.value = 1;
      riskVal.textContent = '1%';
      resultEl.textContent = 'Kết quả sẽ hiển thị ở đây.';
    });

    // optional: prefill with demo values
    // balanceEl.value = 5000; entryEl.value = 2100.25; slEl.value = 2095; tpEl.value = 2110; compute();
  </script>
</body>
</html>